<project name="Thalamus" basedir="." default="makeEntregable">

	<property name="project.name.cap" value="LoJack" />
	<property name="project.name.upper" value="LOJACK" />
	<property name="project.name.lower" value="lojack" />

	<property name="sql.driver" value="com.mysql.jdbc.Driver" />
	<property name="root.url" value="jdbc:mysql://localhost:3306/" />
	<property name="root.user" value="root" />

	<property name="db.url" value="jdbc:mysql://localhost:3306/${project.name.upper}" />
	<property name="db.user" value="${project.name.upper}_USER" />
	<property name="db.pass" value="${project.name.upper}_USER" />

	<taskdef resource="net/sf/antcontrib/antlib.xml"
			classpath="./ant-contrib.jar" />

	<target name="createDatabase">
		<condition property="root.pass" value="root">
			<and>
				<os family="unix" />
			</and>
		</condition>
		<condition property="root.pass" value="">
			<and>
				<not>
					<os family="unix" />
				</not>
			</and>
		</condition>
		<sql driver="${sql.driver}" url="${root.url}" userid="${root.user}" password="${root.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="database.sql" />
		</sql>
	</target>

	<target name="create_jar_applet">
		<tstamp>
			<format property="hora" pattern="yyyyMMddHHmm"/>
		</tstamp>
		<delete>
	      <fileset dir="../WebContent/" includes="cameraviewer-*.jar"/>
	    </delete>
        <jar destfile="../WebContent/cameraviewer-b${hora}.jar" filesetmanifest="mergewithoutmain">
        	<fileset dir="../../Camera/bin"/>
            <fileset dir="../../CameraViewer/bin"/>
            <zipfileset excludes="META-INF/*.SF" src="../../Camera/commons-codec.jar"/>
        </jar>
		<if>
			<not>
				<available file="./LoJackKeyStore" type="file" />
			</not>
			<then>
				<echo>Generating new certificate</echo>
				<delete file="./LoJackKeyStore"/>
				<genkey validity="18250" alias="lojackKeyStore" storepass="lojack" keystore="./LoJackKeyStore">
					<dname>
						<param name="CN" value="LoJack SA" />
						<param name="OU" value="LoJack" />
						<param name="O" value="LoJack" />
						<param name="C" value="AR" />
					</dname>
				</genkey>
			</then>
		</if>
		<signjar alias="lojackKeyStore" storepass="lojack" keystore="./LoJackKeyStore" jar="../WebContent/cameraviewer-b${hora}.jar"></signjar>
		<replaceregexp flags="g" match='cameraviewer-b[0-9]{12}.jar' replace='cameraviewer-b${hora}.jar' file="../WebContent/homeCamara.jsp"/>
    </target>

	<target name="createTables" depends="createDatabase">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl.sql" />
			<transaction src="sysproperties.sql" />
			<transaction src="poi_inserts.sql" />
			<transaction src="poi_inserts_gba.sql" />
		</sql>
	</target>
	
	<target name="createTables_Pablo" depends="createDatabase">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl.sql" />
			<transaction src="sysproperties.sql" />
			<transaction src="fixip_pablo.sql" />
			<transaction src="poi_inserts.sql" />
		</sql>
	</target>
	
	<target name="use-prod-conf">
			<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
				<classpath>
					<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
				</classpath>
				<transaction src="sysproperties-prod.sql" />
			</sql>
		</target>

	<target name="useThalamusTest">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="thalamus_test.sql" />
		</sql>
	</target>
	
	<target name="usePrevent-test.lojackgis.com.ar">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="prevent.sql" />
		</sql>
	</target>
	
	<target name="useThalamusFake">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="thalamus_fake.sql" />
		</sql>
	</target>
	
	<target name="useMWTest">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="use_mw_test.sql" />
		</sql>
	</target>
	
	<target name="useMWFake">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="use_mw_fake.sql" />
		</sql>
	</target>
	
	<target name="incremental-01">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl1.sql" />
		</sql>
	</target>
	
	
	<target name="incremental-03">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl3.sql" />
		</sql>
	</target>
	
	<target name="incremental-04">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl4.sql" />
		</sql>
	</target>
	
	<target name="incremental-05">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl5.sql" />
		</sql>
	</target>
	
	<target name="incremental-06">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="ddl6.sql" />
		</sql>
	</target>
	
	<target name="incremental-parkings-gba">
		<sql driver="${sql.driver}" url="${db.url}" userid="${db.user}" password="${db.pass}">
			<classpath>
				<pathelement location="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" />
			</classpath>
			<transaction src="poi_inserts_gba.sql" />
		</sql>
	</target>

	<target name="makeWar">
		<delete file="./${project.name.upper}.tmp/${project.name.upper}_WEB.war">
		</delete>
		<war destfile="./${project.name.upper}.tmp/${project.name.upper}_WEB.war" basedir="../../${project.name.cap}Web/WebContent" webxml="../../${project.name.cap}Web/WebContent/WEB-INF/web.xml">
			<classes dir="../../thalamusJClient/ThalamusJClient/bin" />
			<classes dir="../../Camera/bin" />
			<lib dir="../../thalamusJClient/EnvironmentLibraries/">
				<include name="*.jar" />
				<!--exclude name="servlet-api.jar" />
				<exclude name="jsch-0.1.39.jar" /-->
				<exclude name="cue.language.jar" />
				<exclude name="asm-3.3.1.jar" />
				<exclude name="cglib-2.2.2.jar" />
				<exclude name="iText-2.0.8.jar" />
				<exclude name="jakarta-oro.jar" />
				<exclude name="jfor-0.7.2rc1.jar" />
				<exclude name="jtidy-r938.jar" />
				<exclude name="nekohtml.jar" />
				<exclude name="pluginibator.jar" />
				<exclude name="poi-3.1-FINAL-20080629.jar" />
				<exclude name="urlrewrite-3.2.0.jar" />
				<exclude name="xercesImpl-2.8.0.jar" />
				<exclude name="xml-apis-xerces-2.9.1.jar" />
				<exclude name="servlet-api.jar" />
				<exclude name="log4j-1.2.16.jar" />
				<exclude name="yuicompressor-2.4.6.jar"/>
				<exclude name="mysql-connector-java-5.1.13-bin.jar" />
				<exclude name="sqljdbc4.jar" />
			</lib>
		</war>
		<unwar src="${project.name.upper}.tmp/${project.name.upper}_WEB.war" dest="${project.name.upper}.tmp/${project.name.upper}_WEB.war1">
		</unwar>
		<delete file="${project.name.upper}.tmp/${project.name.upper}_WEB.war"></delete>
		
		<copy todir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/WEB-INF/lib" file="../../thalamusJClient/ThalamusJClient/commons-httpclient.jar"></copy>
		<!--antcall target="js.minify"></antcall-->
		<delete file="./${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war"></delete>
		<war destfile="./${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war" basedir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1" webxml="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/WEB-INF/web.xml">
		</war>
		
		<replaceregexp file="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/WEB-INF/web.xml" match="!-- context-param" replace="context-param"></replaceregexp>
		<replaceregexp file="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/WEB-INF/web.xml" match="context-param--" replace="context-param"></replaceregexp>
		<delete file="./${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war"></delete>
		<war destfile="./${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war" basedir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1" webxml="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/WEB-INF/web.xml">
		</war>
		
		<delete dir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1" failonerror="false"></delete>
		
		<war destfile="./${project.name.upper}.tmp/GIS_WEB.war" basedir="../../GISWeb/WebContent" webxml="../../GISWeb/WebContent/WEB-INF/web.xml">
		</war>
		<war destfile="./${project.name.upper}.tmp/ThalamusWeb.war" basedir="../../ThalamusWeb/WebContent" webxml="../../ThalamusWeb/WebContent/WEB-INF/web.xml">
			<lib dir="../../thalamusJClient/EnvironmentLibraries/">
							<include name="*.jar" />
							<!--exclude name="servlet-api.jar" />
							<exclude name="jsch-0.1.39.jar" /-->
						</lib>
		</war>
		
		<war destfile="./${project.name.upper}.tmp/LoJackCameraWEB.war" basedir="../../LoJackCameraWeb/WebContent" webxml="../../LoJackCameraWeb/WebContent/WEB-INF/web.xml">
			<classes dir="../../Camera/bin" />
			<lib dir="../../thalamusJClient/EnvironmentLibraries/">
				<include name="commons*.jar" />
				<include name="javabase.jar" />
			</lib>
		</war>
	</target>

	<target name="js.minify">
		<apply verbose="true" executable="java" parallel="false" relative="true" dir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/js/">
			<fileset dir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/js" includes="*.js" excludes="jquery.jstepper.js"/>
			<arg value="-jar" />
			<arg path="../../thalamusJClient/EnvironmentLibraries/yuicompressor-2.4.6.jar"/>
            <arg value="--charset"/>
            <arg value="ISO-8859-1" />
            <arg value="-o" />
			<srcfile />
			<mapper type="glob" from="*.js" to="*.js" />
			<targetfile />
		</apply>

		<apply verbose="true" executable="java" parallel="false" relative="true" dir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/css/">
			<fileset dir="${project.name.upper}.tmp/${project.name.upper}_WEB.war1/css" includes="*.css"/>
			<arg value="-jar" />
			<arg path="../../thalamusJClient/EnvironmentLibraries/yuicompressor-2.4.6.jar"/>
            <arg value="--charset"/>
            <arg value="ISO-8859-1" />
            <arg value="-o" />
			<srcfile />
			<mapper type="glob" from="*.css" to="*.css" />
			<targetfile />
		</apply>
	</target>

	<target name="makeEntregable">
		<property file="build.properties" />
		<input
		    message="Ingrese la version, anterior ${current}:"
		    addproperty="build.version"
		  />
		<propertyfile
		    file="build.properties">
		  <entry  key="current" value="${build.version}"/>
		</propertyfile>
		<copy file="../WebContent/includes/version.template" tofile="../WebContent/includes/version.jspf" overwrite="true" encoding="ISO-8859-1">
			<filterset>
		      <filter token="VERSION" value="${build.version}"/>
		    </filterset>
		</copy>
		<delete dir="${project.name.upper}.tmp" failonerror="false">
		</delete>
		<mkdir dir="${project.name.upper}.tmp" />
		<mkdir dir="${project.name.upper}.tmp/mysql" />
		<mkdir dir="${project.name.upper}.tmp/sqlserver" />
		<antcall target="makeWar">
		</antcall>
		<copy todir="${project.name.upper}.tmp" file="Instrucciones.txt">
		</copy>
		<!--copy todir="${project.name.upper}.tmp" file="${project.name.upper}_WEB.xml">
		</copy-->
		
		<!-- mysql -->
		<!--copy file="ddl.sql" tofile="${project.name.upper}.tmp/mysql/create-mysql.sql">
		</copy>
		<concat destfile="${project.name.upper}.tmp/mysql/create-mysql.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="sysproperties.sql"/>
		</concat>
		<concat destfile="${project.name.upper}.tmp/mysql/create-mysql.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="poi_inserts.sql"/>
		</concat-->
		<copy file="ddl3.sql" tofile="${project.name.upper}.tmp/mysql/ddl3.sql">
			</copy>
		
		<!-- sql server -->
		<!--copy file="ddl-sqlserver.sql" tofile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql">
		</copy>
		<concat destfile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="sysproperties.sql"/>
		</concat>
		<concat destfile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="poi_inserts.sql"/>
		</concat-->
		<copy file="ddl3-sqlserver.sql" tofile="${project.name.upper}.tmp/sqlserver/ddl3-sqlserver.sql">
			</copy>
		
		<!-- datasources -->
		<copy file="./jboss/mysql-ds.xml" todir="${project.name.upper}.tmp/mysql/">
		</copy>
		<copy file="./jboss/sqlserver-ds.xml" todir="${project.name.upper}.tmp/sqlserver/">
		</copy>
		
		<!-- drivers -->
		<copy file="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" todir="${project.name.upper}.tmp/mysql/">
		</copy>
		<copy file="../../thalamusJClient/EnvironmentLibraries/sqljdbc4.jar" todir="${project.name.upper}.tmp/sqlserver/">
		</copy>
		
		<!--copy file="./database.sql" tofile="${project.name.upper}.tmp/mysql/db-mysql.sql">
		</copy>
		<copy file="./database-sqlserver.sql" tofile="${project.name.upper}.tmp/sqlserver/db-sqlserver.sql">
		</copy-->
		
		<mkdir dir="${project.name.upper}.tmp/camera-server" />
		<jar destfile="${project.name.upper}.tmp/camera-server/camera-server.jar" filesetmanifest="mergewithoutmain">
            <manifest>
                <attribute name="Main-Class" value="com.tdil.lojack.camera.CameraServer"/>
                <attribute name="Class-Path" value="."/>
            </manifest>
            <fileset dir="../../LoJackCameraStandAlone/bin"/>
            <zipfileset excludes="META-INF/*.SF" src="../../LoJackCameraStandAlone/log4j-1.2.16.jar"/>
            <fileset dir="../../Camera/bin"/>
            <zipfileset excludes="META-INF/*.SF" src="../../Camera/commons-codec.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="../../LoJackCameraStandAlone/commons-codec.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="../../LoJackCameraStandAlone/commons-io-1.4.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="../../LoJackCameraStandAlone/commons-lang.jar"/>
        </jar>
		<copy file="../../LoJackCameraStandAlone/config.properties" tofile="${project.name.upper}.tmp/camera-server/config.properties">
		</copy>
		<copy file="../../LoJackCameraStandAlone/log4j.xml" tofile="${project.name.upper}.tmp/camera-server/log4j.xml">
		</copy>
		<copy file="../../LoJackCameraStandAlone/run.sh" tofile="${project.name.upper}.tmp/camera-server/run.sh">
		</copy>
	</target>
	
	<!-- build para lojack -->
	<path id="environment.libraries">
		<fileset dir="../../thalamusJClient/EnvironmentLibraries/"
			includes="**/*.jar" />
	</path>
	<path id="th.environment.libraries">
		<fileset dir="../../thalamusJClient/ThalamusJClient/"
			includes="**/*.jar" />
	</path>
	
	<target name="prepare_lojack_build">
		<delete dir="${project.name.upper}.tmp" failonerror="false">
		</delete>
		<mkdir dir="${project.name.upper}.tmp" />
		<mkdir dir="${project.name.upper}.tmp/mysql" />
		<mkdir dir="${project.name.upper}.tmp/sqlserver" />
		<mkdir dir="${project.name.upper}.tmp/libraries" />
		<mkdir dir="${project.name.upper}.tmp/src" />
		<mkdir dir="${project.name.upper}.tmp/src/Camera" />
		<mkdir dir="${project.name.upper}.tmp/src/CameraViewer" />
		<mkdir dir="${project.name.upper}.tmp/src/LoJackWeb" />
		<copy todir="${project.name.upper}.tmp/libraries" flatten="true">
			<fileset dir="../../thalamusJClient/EnvironmentLibraries/">
				<include name="*.jar" />
				<!--exclude name="servlet-api.jar" />
				<exclude name="jsch-0.1.39.jar" /-->
				<exclude name="cue.language.jar" />
				<exclude name="asm-3.3.1.jar" />
				<exclude name="cglib-2.2.2.jar" />
				<exclude name="iText-2.0.8.jar" />
				<exclude name="jakarta-oro.jar" />
				<exclude name="jfor-0.7.2rc1.jar" />
				<exclude name="jtidy-r938.jar" />
				<exclude name="nekohtml.jar" />
				<exclude name="pluginibator.jar" />
				<exclude name="poi-3.1-FINAL-20080629.jar" />
				<exclude name="urlrewrite-3.2.0.jar" />
				<exclude name="xercesImpl-2.8.0.jar" />
				<exclude name="xml-apis-xerces-2.9.1.jar" />
				<!--exclude name="servlet-api.jar" /-->
				<!--exclude name="log4j-1.2.16.jar" /-->
				<exclude name="yuicompressor-2.4.6.jar"/>
				<exclude name="mysql-connector-java-5.1.13-bin.jar" />
				<exclude name="sqljdbc4.jar" />
			</fileset>
		</copy>
		<copy todir="${project.name.upper}.tmp/libraries" flatten="true">
			<fileset dir="../../thalamusJClient/ThalamusJClient/">
				<include name="commons-httpclient.jar" />
			</fileset>
		</copy>
		
		<delete dir="${project.name.upper}.tmp/bin"></delete>
		<mkdir dir="${project.name.upper}.tmp/bin" />
		<javac encoding="ISO-8859-1" srcdir="../../thalamusJClient/ThalamusJClient/src" debug="on" destdir="${project.name.upper}.tmp/bin">
			<classpath refid="environment.libraries" />
			<classpath refid="th.environment.libraries" />
		</javac>
		<jar jarfile="${project.name.upper}.tmp/libraries/ThalamusJClient.jar" basedir="${project.name.upper}.tmp/bin"/>
		<delete dir="${project.name.upper}.tmp/bin"></delete>
		
		<copy todir="${project.name.upper}.tmp" file="Instalacion.docx">
		</copy>
		<!--copy todir="${project.name.upper}.tmp" file="${project.name.upper}_WEB.xml">
		</copy-->
		
		<!-- mysql -->
		<copy file="ddl.sql" tofile="${project.name.upper}.tmp/mysql/create-mysql.sql">
		</copy>
		<concat destfile="${project.name.upper}.tmp/mysql/create-mysql.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="sysproperties.sql"/>
		</concat>
		<concat destfile="${project.name.upper}.tmp/mysql/create-mysql.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="poi_inserts.sql"/>
		</concat>
		
		<!-- sql server -->
		<copy file="ddl-sqlserver.sql" tofile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql">
		</copy>
		<concat destfile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="sysproperties.sql"/>
		</concat>
		<concat destfile="${project.name.upper}.tmp/sqlserver/create-sqlserver.sql" append="true" fixlastline="true" encoding="UTF-8">
			<filelist dir="./" files="poi_inserts.sql"/>
		</concat>
		
		<!-- datasources -->
		<copy file="./jboss/mysql-ds.xml" todir="${project.name.upper}.tmp/mysql/">
		</copy>
		<copy file="./jboss/sqlserver-ds.xml" todir="${project.name.upper}.tmp/sqlserver/">
		</copy>
		
		<!-- drivers -->
		<copy file="../../thalamusJClient/EnvironmentLibraries/mysql-connector-java-5.1.13-bin.jar" todir="${project.name.upper}.tmp/mysql/">
		</copy>
		<copy file="../../thalamusJClient/EnvironmentLibraries/sqljdbc4.jar" todir="${project.name.upper}.tmp/sqlserver/">
		</copy>
		
		<copy file="./database.sql" tofile="${project.name.upper}.tmp/mysql/db-mysql.sql">
		</copy>
		<copy file="./database-sqlserver.sql" tofile="${project.name.upper}.tmp/sqlserver/db-sqlserver.sql">
		</copy>
		
		<antcall target="makeWar"></antcall>
		<move file="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war" tofile="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war1"></move>
		<unwar src="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war1" dest="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src">
		</unwar>
		<delete file="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war1"></delete>
		<move file="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war" tofile="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war1"></move>
		<unwar src="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war1" dest="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src">
		</unwar>
		<delete file="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war1"></delete>
		<delete dir="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src/WEB-INF/classes"></delete>
		<mkdir dir="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src/WEB-INF/classes" />
		<delete dir="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src/WEB-INF/classes"></delete>
		<mkdir dir="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src/WEB-INF/classes" />
		
		<delete dir="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src/WEB-INF/lib"></delete>
		<mkdir dir="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src/WEB-INF/lib" />
		<delete dir="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src/WEB-INF/lib"></delete>
		<mkdir dir="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src/WEB-INF/lib" />
		
		<delete>
	      <fileset dir="${project.name.upper}.tmp/mysql/${project.name.upper}_WEB.war-src/" includes="cameraviewer-*.jar"/>
	    </delete>
		<delete>
	      <fileset dir="${project.name.upper}.tmp/sqlserver/${project.name.upper}_WEB.war-src/" includes="cameraviewer-*.jar"/>
	    </delete>
			
		<copy todir="${project.name.upper}.tmp/src/Camera">
			<fileset dir="../../Camera/src">
				<include name="**/*.*"/>
			</fileset>
		</copy>
		<copy todir="${project.name.upper}.tmp/src/CameraViewer">
			<fileset dir="../../CameraViewer/src">
				<include name="**/*.*"/>
			</fileset>
		</copy>
		<copy todir="${project.name.upper}.tmp/src/LoJackWeb">
			<fileset dir="../../LoJackWeb/JavaSource">
				<include name="**/*.*"/>
			</fileset>
		</copy>
		<copy file="./build.xml" tofile="${project.name.upper}.tmp/build.xml"></copy>
	</target>

</project>